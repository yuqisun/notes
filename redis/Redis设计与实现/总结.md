## 字典
hash表负载因子 = 哈希表已保存节点数量 / 哈希表大小  
load_factor = ht[0].used / ht[0].size

#### 哈希表的扩展与收缩
1. 扩展与收缩条件
2. 按照 rehashidx 进行渐进式 rehash（字典包含两个 hash表 ht[0] 和 ht[1]，用于复制，类似于cluster槽从一个节点的转移到另一个）
3. 渐进式 rehash执行期间的哈希表操作

## 对象
1. 对象的内部结构
2. 引用计数内存回收
3. 引用计数实现多数据库键共享同一对象，节约内存
4. 对象带有访问时间记录信息，记录空转时间，超过maxmemory时，释放空转时间长的键

#### 字符串对象
* 编码
  1. int - 保存的是整数值，且可以用 long类型来表示
  2. raw - 保存的是一个字符串值，且长度大于 39字节，使用SDS来保存这个字符串
  3. embstr - 保存的是一个字符串值，且长度小于等于 39字节，embstr是专门用于保存短字符的一种优化编码方式
* embstr 优点

## 数据库
#### 读写键空间时的维护操作
1. 记录命中和不命中次数，可以在 INFO stats 中看到
2. 更新最后一次使用时间(LRU)，用于计算闲置时间
3. 如果键过期则删除
4. 如果有客户端 watch了某个键，将键标记为 dirty
5. ...

#### 设置过期时间
EXPIRE, PEXPIRE, EXPIREAT 三个命令都是使用 PEXPIREAT 命令来实现的

#### 过期键的判定
1. 检查过期字典
2. 检查当前 UNIX 时间戳是否大于键的过期时间

#### 过期键删除策略
惰性删除和过期删除  

#### RDB文件对过期键的处理
已过期键不会被保存到新创建的 RDB文件中  

* 载入RDB文件
  * 主服务器忽略过期键
  * 从服务器不忽略

#### AOF写入对过期键的处理
没有被删除的键没有影响，已经删除的，追加 DEL命令到AOF文件中

#### 主从
从服务器的过期键由主服务器控制，自己不能删除


##　





## 选举领头
### 选举领头 Sentinel(Raft算法的领头选举)
### Cluster 选举新的主节点(Raft算法的领头选举)

## 故障转移
### Sentinel故障转移
##### 选出新的主服务器
1. 从服务器优先级
2. 偏移量(偏移量最大的保存着最新的数据)
3. 运行ID 最小的服务器
### Cluster故障转移


